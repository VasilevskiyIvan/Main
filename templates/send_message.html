<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/styles.css">
    <title>Создание рассылки</title>
    <style>
        /* Дополнительные стили для языковых вкладок */
        .lang-tabs {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        .lang-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: #f5f5f5;
        }
        .lang-tab.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .lang-content {
            display: none;
        }
        .lang-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <h1>Создание рассылки</h1>
    </header>
    <div class="container">
        <!-- Выпадающий список пользователей -->
        <div class="user-select">
            <label>Получатель:</label>
            <select id="userSelect" name="user_id">
                {% for user in tg_users %}
                    <option value="{{ user.id }}">{{ user.username }} ({{ user.full_name }})</option>
                {% endfor %}
            </select>
        </div>

        <!-- Языковые вкладки -->
        <div class="lang-tabs">
            <div class="lang-tab active" onclick="switchLang('ru')">Русский</div>
            <div class="lang-tab" onclick="switchLang('en')">English</div>
            <div class="lang-tab" onclick="switchLang('ar')">العربية</div>
            <div class="lang-tab" onclick="switchLang('zh')">中文</div>
        </div>

        <form id="broadcastForm" action="/broadcast/new" method="post" enctype="multipart/form-data">
            <!-- Поля для русского языка -->
            <div class="lang-content active" id="ru">
                <label for="title_ru">Название (русский):</label>
                <input type="text" id="title_ru" name="title_ru" required>

                <label for="description_ru">Описание (русский):</label>
                <textarea id="description_ru" name="description_ru" rows="5" required></textarea>
            </div>

            <!-- Поля для английского языка -->
            <div class="lang-content" id="en">
                <label for="title_en">Title (English):</label>
                <input type="text" id="title_en" name="title_en" required>

                <label for="description_en">Description (English):</label>
                <textarea id="description_en" name="description_en" rows="5" required></textarea>
            </div>

            <!-- Поля для арабского языка -->
            <div class="lang-content" id="ar">
                <label for="title_ar" dir="rtl">العنوان (العربية):</label>
                <input type="text" id="title_ar" name="title_ar" required dir="rtl">

                <label for="description_ar" dir="rtl">الوصف (العربية):</label>
                <textarea id="description_ar" name="description_ar" rows="5" required dir="rtl"></textarea>
            </div>

            <!-- Поля для китайского языка -->
            <div class="lang-content" id="zh">
                <label for="title_zh">标题 (中文):</label>
                <input type="text" id="title_zh" name="title_zh" required>

                <label for="description_zh">描述 (中文):</label>
                <textarea id="description_zh" name="description_zh" rows="5" required></textarea>
            </div>

            <!-- Блоки для загрузки медиа (оставлены как в примере) -->
            <!-- Предпросмотр и загрузка фотографий -->
            <h3>Фотографии</h3>
            <div class="preview-slider" id="imageSlider">
                <p>Добавьте изображения для предпросмотра</p>
            </div>
            <div class="slider-counter" id="imageCounter">0 / 0</div>
            <div class="slider-controls" style="display: none;" id="imageControls">
                <button type="button" class="nav-button" onclick="prevSlide('imageSlider', 'image')">Назад</button>
                <button type="button" class="delete-button" onclick="deleteCurrentFile('image')">Удалить</button>
                <button type="button" class="nav-button" onclick="nextSlide('imageSlider', 'image')">Вперед</button>
            </div>

            <div class="upload-container">
                <input type="file" id="imageInput" accept="image/*" multiple onchange="updateFileName('image')"><br>
                <button type="button" class="add-button" onclick="addFile('image')">Добавить фото</button>
                <button type="button" class="custom-button" onclick="document.getElementById('imageInput').click()">Выбрать фото</button>
                <span class="file-name" id="imageFileName">Не выбран файл</span>
            </div>

            <!-- Предпросмотр и загрузка видео -->
            <h3>Видео</h3>
            <div class="preview-slider" id="videoSlider">
                <p>Добавьте видео для предпросмотра</p>
            </div>
            <div class="slider-counter" id="videoCounter">0 / 0</div>
            <div class="slider-controls" style="display: none;" id="videoControls">
                <button type="button" class="nav-button" onclick="prevSlide('videoSlider', 'video')">Назад</button>
                <button type="button" class="delete-button" onclick="deleteCurrentFile('video')">Удалить</button>
                <button type="button" class="nav-button" onclick="nextSlide('videoSlider', 'video')">Вперед</button>
            </div>

            <div class="upload-container">
                <input type="file" id="videoInput" accept="video/*" multiple onchange="updateFileName('video')"><br>
                <button type="button" class="add-button" onclick="addFile('video')">Добавить видео</button>
                <button type="button" class="custom-button" onclick="document.getElementById('videoInput').click()">Выбрать видео</button>
                <span class="file-name" id="videoFileName">Не выбран файл</span>
            </div>

            <button type="button" class="save-block-button" onclick="submitBroadcastForm()">Отправить рассылку</button>
        </form>
    </div>

    <script>
        // Логика переключения языковых вкладок
        function switchLang(lang) {
            // Убираем активный класс у всех вкладок и контента
            document.querySelectorAll('.lang-tab, .lang-content').forEach(el => {
                el.classList.remove('active');
            });

            // Добавляем активный класс выбранной вкладке и контенту
            document.querySelector(`.lang-tab[onclick*="${lang}"]`).classList.add('active');
            document.getElementById(lang).classList.add('active');
        }

        // Переиспользуем JavaScript из предыдущего примера с небольшими изменениями
        const files = { image: [], video: [] };
        const indices = { image: 0, video: 0 };

        // Остальные функции (deleteCurrentFile, addFile, renderSlider,
        // updateCounter, prevSlide, nextSlide, updateFileName)
        // остаются такими же как в предыдущем примере

        // Модифицированная функция отправки формы
        async function submitBroadcastForm() {
            const formData = new FormData(document.getElementById('broadcastForm'));

            // Добавляем выбранного пользователя
            const userId = document.getElementById('userSelect').value;
            formData.append('user_id', userId);

            // Добавляем медиафайлы
            files.image.forEach(item => formData.append('images', item.file));
            files.video.forEach(item => formData.append('videos', item.file));

            try {
                const response = await fetch('/broadcast/new', {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) throw new Error('Ошибка отправки');

                alert('Рассылка успешно создана!');
                window.location.href = '/broadcast';
            } catch (error) {
                console.error(error);
                alert('Ошибка при создании рассылки');
            }
        }

        // Инициализация первого языка
        document.addEventListener('DOMContentLoaded', () => {
            switchLang('ru');
        });
    </script>
</body>
</html>